#!/bin/sh

#set -e
echo "Initial preparation...this can take awhile, so sit tight..."

aclocal

# We don't need libtool, but it creates config.sub & config.guess - <sigh>
libtoolize --automake --copy --force

# Create config.h
autoheader

# Neither do we need automake, but it provides "missing", "install-sh" and "mkinstalldirs"
automake --foreign --add-missing --copy

#Create configure script
autoconf

echo "Writing Makefiles:"

MODULES="tools tools/disasm tools/shapeconv misc convert convert/u8 convert/crusader filesys"

for subdir in $MODULES; do
  rm -f $subdir/Makefile
  echo "# This file is generated automatically by bootstrap. Do not edit!" > $subdir/Makefile
  echo "" >> $subdir/Makefile
  echo "" >> $subdir/Makefile
  echo "LPATH := $subdir" >> $subdir/Makefile
  echo "" >> $subdir/Makefile
  cat >> $subdir/Makefile <<'EOF'
all: all-$(LPATH) ;
clean: clean-$(LPATH) ;

# Catch all rule - call Makefile in parent dir
%::
	cd .. && $(MAKE) $@

.PHONY: all clean

EOF

  echo "  $subdir/Makefile"

done

echo ""
echo "You are now ready to run ./configure ..."
